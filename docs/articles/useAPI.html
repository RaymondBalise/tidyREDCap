<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importing from REDCap • tidyREDCap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Importing from REDCap">
<meta property="og:description" content="tidyREDCap">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyREDCap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/import_instruments.html">Import All Instruments from a REDCap Project</a>
    </li>
    <li>
      <a href="../articles/makeBinaryWord.html">Make Binary Word</a>
    </li>
    <li>
      <a href="../articles/makeChooseAllTable.html">Make a 'Choose All' Table</a>
    </li>
    <li>
      <a href="../articles/makeChooseOneTable.html">Make a 'Choose One' Table</a>
    </li>
    <li>
      <a href="../articles/makeInstrument.html">Make an Instrument</a>
    </li>
    <li>
      <a href="../articles/useAPI.html">Importing from REDCap</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RaymondBalise/tidyREDCap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Importing from REDCap</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RaymondBalise/tidyREDCap/blob/HEAD/vignettes/useAPI.Rmd" class="external-link"><code>vignettes/useAPI.Rmd</code></a></small>
      <div class="hidden name"><code>useAPI.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://raymondbalise.github.io/tidyREDCap/index.html" class="external-link">tidyREDCap</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="loading-redcap-data-into-r-with-an-api-request">Loading REDCap Data into R with an API request<a class="anchor" aria-label="anchor" href="#loading-redcap-data-into-r-with-an-api-request"></a>
</h2>
<p>While most people use the “Data Exports, Reports and Stats”
Application built into REDCap, another handy method to get data out of
REDCap is an API request. An API allows one program to request data from
another program. For example, an add-on package in R can request data
from your instance of REDCap. Obviously, an R package can not
<em>type</em> your user name and password. Instead, you will store an
API token, a password, on your machine and then ask R to look up that
token and pass it to REDCap whenever you want data.</p>
<p>We have used two R packages to access our REDCap
projects,<code>redcapAPI</code> and <code>REDCapR</code>. Unfortunately,
<code>redcapAPI</code> is no longer being actively developed, and we
have run into problems with it. It had the lovely benefit of exporting
variables, basically using the same variable names as you see in REDCap,
then tagging the variables with the “labels” subjects viewed when
completing the forms.</p>
<p>that people taking REDCap surveys or viewing other forms see.</p>
<p>We have taken the labeling functionality and added it in
tidyREDCap.</p>
<div class="section level4">
<h4 id="getting-an-api-token">Getting an API Token<a class="anchor" aria-label="anchor" href="#getting-an-api-token"></a>
</h4>
<p>If your REDCap project has API access enabled, you will see it in the
applications on the left side of the screen.</p>
<p><img src="key.jpg"></p>
<p>If you don’t see that option, talk to your project leader or the
REDCap system administrator.</p>
<p>When you click the link you will be given the option to create an API
Token for this project.</p>
<p>Once you have that token created, you can copy and paste it somewhere
safe.</p>
</div>
<div class="section level4">
<h4 id="protecting-your-api-tokens">Protecting Your API Tokens<a class="anchor" aria-label="anchor" href="#protecting-your-api-tokens"></a>
</h4>
<p>Leaders in the REDCap community have developed techniques for safely
storing your REDCap API keys. Ask your REDCap systems administrators how
they prefer you store API keys on your “local machine”.</p>
<div class="section level5">
<h5 id="never-do-this">NEVER DO THIS!<a class="anchor" aria-label="anchor" href="#never-do-this"></a>
</h5>
<p>The functions that allow you to export data need you to give them
your API token. Remember, this is the same information as your username
and password. <strong>NEVER</strong> type that directly in your code.
That is if your REDCap API key is “1A2B3CXXYYZZOOMMGOSHNOOOOX1Y2Z3” do
NOT do this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Do not type your API token directly into your code</span></span>
<span><span class="fu">tidyREDCap</span><span class="fu">::</span><span class="fu"><a href="../reference/import_instruments.html">import_instruments</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://redcap.miami.edu/api/"</span>,</span>
<span>  <span class="st">"1A2B3CXXYYZZOOMMGOSHNOOOOX1Y2Z3"</span> <span class="co"># This is BAD!</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you do this, anybody who gets a copy of your code will be able to
access your REDCap project. Also, whenever your run this line of code,
the API token will be saved into your R history files.</p>
</div>
<div class="section level5">
<h5 id="better-options">Better Options<a class="anchor" aria-label="anchor" href="#better-options"></a>
</h5>
<p>You can save your API keys into a “hidden” file containing code that
runs when you start R. That file is called you “.Renviron”. It can be a
bit of a pain to find. So your best plan is to install the
<code>usethis</code> package, which contains helper functions, including
a function to find this file. If you use the RStudio interface, you can
add it using the Packages window pane or run these lines in the console
once.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_cran.html" class="external-link">install_cran</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span></code></pre></div>
<p>When it comes time to add packages to your copy of R, the
<code>install_cran()</code> function in the <code>remotes</code> package
is superior to the usual <code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code> function
because it will first check to see if you already have the latest
version before bothering to download and install.</p>
<p>After installing <code>usethis</code> you can access your “.Renviron”
file by typing this in your console.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_profile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It will cause the file to open.</p>
<p>Create a name for your API key and add a like like this to your
.Renviron file:</p>
<pre><code><span><span class="va">nacho_anxiety_key</span><span class="op">=</span><span class="st">"1A2B3CXXYYZZOOMMGOSHNOOOOX1Y2Z3"</span></span></code></pre>
<p>After adding the line, remember to save the file and completely
restart R/RStudio.</p>
<p>Once R restarts, you can access the key like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyREDCap</span><span class="fu">::</span><span class="fu"><a href="../reference/import_instruments.html">import_instruments</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://redcap.miami.edu/api/"</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"nacho_anxiety_key"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you want to use the redcapAPI or the REDCapR packages directly you
can use the same trickery to pass your API key to their functions. For
example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcon</span> <span class="op">&lt;-</span> <span class="fu">redcapAPI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redcapAPI/man/redcapConnection.html" class="external-link">redcapConnection</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">'https://redcap.miami.edu/api/'</span>, </span>
<span>  token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"nacho_anxiety_key"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">redcap</span> <span class="op">&lt;-</span> <span class="fu">redcapAPI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redcapAPI/man/exportRecords.html" class="external-link">exportRecords</a></span><span class="op">(</span><span class="va">rcon</span><span class="op">)</span></span></code></pre></div>
<p>This includes a call to <code><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv()</a></code> to grab the key. To
learn more about working with APIs, look <a href="https://daattali.gitbooks.io/stat545-ubc-github-io/bit003_api-key-env-var.html" class="external-link">here</a>.</p>
<p>If you are curious, when we made these help files, we saved the data
using the <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcon</span> <span class="op">&lt;-</span> <span class="fu">redcapAPI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redcapAPI/man/redcapConnection.html" class="external-link">redcapConnection</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">'https://redcap.miami.edu/api/'</span>, </span>
<span>  token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"nacho_anxiety_key"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">redcap</span> <span class="op">&lt;-</span> <span class="fu">redcapAPI</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/redcapAPI/man/exportRecords.html" class="external-link">exportRecords</a></span><span class="op">(</span><span class="va">rcon</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">redcap</span>, file <span class="op">=</span> <span class="st">"redcap.rds"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
</div>
<div class="section level4">
<h4 id="even-better-options">Even Better Options<a class="anchor" aria-label="anchor" href="#even-better-options"></a>
</h4>
<p>If somebody gets access to the files on your machine, they could find
and read your .Renviron file. A more secure option is to use the r
<code>keyring</code> package. It will store an encrypted copy of your
API key in your machine’s credential store (i.e., the “keychain” on
macOS, the Credential Store on Windows, etc.). Consider using it. If you
use it and your machine is stolen, it will buy you more time to find an
internet connection, log into REDCap and change your API tokens (before
the thief can access your data).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Raymond Balise, Gabriel Odom, Anna Calderon, Layla Bouzoubaa, Wayne DeFreitas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
